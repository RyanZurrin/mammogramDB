<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>omama.analysis.global_df_copy API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>omama.analysis.global_df_copy</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import glob
import os

# reading in dicom files
import pydicom as dicom
from os import listdir
from os.path import isfile, join
import pandas as pd
from collections import Counter
import pickle
import seaborn as sns
import matplotlib.pyplot as plt
import hvplot.pandas
import time


class Global_Plot:
    #     df = pd.DataFrame()

    def __init__(self, df, path=None):
        # sets the Data path variable
        self.path = str(path)

        t0 = time.time()

        #         pickles = [&#39;dh_dh2&#39;, &#39;dh_dh0new&#39;, &#39;dh_dcm_ast&#39;]

        #         for i in range(len(pickles)):
        #             #read the pickle file
        #             picklefile = open(self.path + pickles[i] + &#39;Label&#39;, &#39;rb&#39;)
        #             #unpickle the dataframe
        #             df_new = pickle.load(picklefile)
        #             self.df = pd.concat([self.df, df_new], ignore_index=True, sort=False)
        #             #close file
        #             picklefile.close()

        #         self.df = df
        print(&#34;Total dicoms available&#34;)
        print(Counter(df[&#34;image&#34;]))
        print(Counter(df[&#34;label&#34;]))
        print(Counter(df[&#34;Imagelaterality&#34;]))

    def index_pre(self, df):
        df1 = df.copy()
        df1[&#34;label&#34;] = df1[&#34;label&#34;].replace([&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], &#34;Cancer&#34;)
        df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
        df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

        #         df_plot = df1.groupby([&#39;label&#39;, &#39;image&#39;, &#39;Imagelaterality&#39;]).size().reset_index().pivot(columns=[&#39;label&#39;], index=[&#39;Imagelaterality&#39;, &#39;image&#39;], values=0)

        #         df_plot.plot(kind=&#39;bar&#39;, stacked=True, cmap = &#39;Paired&#39;)
        #         plt.title(&#34;Cancer(Index+PreIndex) vs Non Cancer dicoms for global&#34;)
        #         plt.ylabel(&#39;No. of labels&#39;)
        #         plt.show()

        return df1

    def nonCancer_pre(self, df):
        df1 = df.copy()

        df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
            [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], [&#34;Cancer&#34;, &#34;NonCancer&#34;]
        )
        df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
        df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

        #         df_plot = df1.groupby([&#39;label&#39;, &#39;image&#39;, &#39;Imagelaterality&#39;]).size().reset_index().pivot(columns=[&#39;label&#39;], index=[&#39;Imagelaterality&#39;, &#39;image&#39;], values=0)

        #         df_plot.plot(kind=&#39;bar&#39;, stacked=True, cmap = &#39;Paired&#39;)
        #         plt.title(&#34;Cancer(Index) vs Non Cancer(+PreIndex) dicoms for global&#34;)
        #         plt.ylabel(&#39;No. of labels&#39;)
        #         plt.show()

        return df1

    def create(self, df, xLabel, category, plotLabel, value, plot):
        if plot == &#34;xaxis&#34;:
            plot = df[df[str(plotLabel)] == value].hvplot.bar(
                x=str(xLabel),
                y=&#34;count&#34;,
                by=str(category),
                stacked=True,
                label=str(plotLabel) + &#34;: &#34; + value,
                legend=&#34;top_right&#34;,
                yformatter=&#34;%.0f&#34;,
                ylim=(0, 900000),
            )
        else:
            plot = df[df[str(plotLabel)] == value].hvplot.barh(
                x=str(xLabel),
                y=&#34;count&#34;,
                by=str(category),
                stacked=True,
                label=str(plotLabel) + &#34;: &#34; + value,
                legend=&#34;top_right&#34;,
                xformatter=&#34;%.0f&#34;,
            )

        return plot

    def labelPlot(self, df, PreIndex=&#34;None&#34;):
        df1 = df.copy()
        plotTitle = &#34;None&#34;
        if PreIndex == &#34;NonCancer&#34;:
            df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
                [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], [&#34;Cancer&#34;, &#34;NonCancer&#34;]
            )
            plotTitle = &#34;Cancer(Index) vs Non Cancer(+PreIndex) dicoms for global&#34;
        elif PreIndex == &#34;Cancer&#34;:
            df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
                [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], &#34;Cancer&#34;
            )
            plotTitle = &#34;Cancer(Index+PreIndex) vs Non Cancer dicoms for global&#34;
        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
        df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

        #         df1 = df1.groupby([&#39;label&#39;, &#39;image&#39;,&#39;Imagelaterality&#39;]).size().reset_index(name = &#39;count&#39;)

        #         plotA = self.create(df1, &#39;2D&#39;)
        #         plotB = self.create(df1, &#39;3D&#39;).opts(show_legend=False, yaxis=None)

        #         # add separate plots together again
        #         return (plotA + plotB).opts(title = plotTitle)
        return df1, plotTitle

    def manufacturer(self, df, PreIndex=&#34;None&#34;):
        df1 = df.copy()

        if PreIndex == &#34;Cancer&#34;:
            df1 = self.index_pre(df1)

        elif PreIndex == &#34;NonCancer&#34;:
            df1 = self.nonCancer_pre(df1)

        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        # replacing case sensitive and same manufarcturer name values with one value
        df1[&#34;Manufacturer&#34;] = df1[&#34;Manufacturer&#34;].replace(
            [
                &#34;HOLOGIC, Inc.&#34;,
                &#34;Hologic, Inc.&#34;,
                &#34;HOLOGIC, INC.&#34;,
                &#34;LORAD&#34;,
                &#34;Lorad&#34;,
                &#34;LORAD.&#34;,
                &#34;Lorad, A Hologic Company&#34;,
            ],
            &#34;HOLOGIC, INC.&#34;,
        )
        df1[&#34;Manufacturer&#34;] = df1[&#34;Manufacturer&#34;].replace(
            [&#34;FUJI PHOTO FILM Co., ltd.&#34;, &#34;FUJIFILM Corporation&#34;],
            &#34;FUJIFILM Corporation&#34;,
        )

        #         #multi indexing
        #         df1 = df1.groupby([&#39;Manufacturer&#39;, &#39;image&#39;]).size().reset_index(name = &#39;count&#39;)
        #         plot = df1.hvplot.barh( x=&#39;Manufacturer&#39;, y=&#39;count&#39;, by=&#39;image&#39;, cmap =&#39;Paired&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
        # #         df1.plot(kind=&#39;barh&#39;, stacked=True, cmap = &#39;Paired_r&#39;)
        # #         plt.title(&#34;Manufaractures and modality informations for 2d and 3d dicoms&#34;)
        # #         plt.xlabel(&#39;Count&#39;)
        #         return plot.opts(title = &#34;Manufaractures informations for 2d and 3d dicoms&#34;)
        plotTitle = &#34;Manufacturer distribution&#34;
        return df1, plotTitle

    def imgShape(self, df, PreIndex=&#34;None&#34;):
        # since no of frames can be different so replacing all the similaer pattern 3D shape whith &#39;x&#39;
        df1 = df.copy()

        if PreIndex == &#34;Cancer&#34;:
            df1 = self.index_pre(df1)

        elif PreIndex == &#34;NonCancer&#34;:
            df1 = self.nonCancer_pre(df1)

        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].astype(str)
        df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].str.replace(&#34;(2457, 1890,.*)&#34;, &#34;2457, 1890, x)&#34;)
        df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].str.replace(&#34;(2457, 1996,.*)&#34;, &#34;2457, 1996, x)&#34;)

        # remove shape less than (1024, 1024)
        pattern = &#34;(2059, 652,.*)|(2023, 918,.*)|(512, 512)|(707, 989)|(794, 990)&#34;
        df1 = df1[~df1[&#34;Shape&#34;].str.contains(pattern)]
        # with 2.2% images filtered out

        #         df1 = df1.groupby([&#39;Manufacturer&#39;, &#39;Shape&#39;]).size().reset_index(name = &#39;count&#39;)
        # not select if count &lt; 50
        counts = df1[&#34;Shape&#34;].value_counts()
        df1 = df1[~df1[&#34;Shape&#34;].isin(counts[counts &lt; 50].index)]

        df1 = df1.sort_values(by=&#34;Shape&#34;)
        #         # multi indexing
        #         df1 = df1.pivot(columns=[&#39;image&#39;], index=[&#39;Shape&#39;], values=&#39;count&#39;)

        #         df1.plot(kind=&#39;barh&#39;, stacked=True, cmap = &#39;Paired_r&#39;)
        #         plt.title(&#34;img_shape for 2d and 3d dicoms&#34;)
        #         plt.xlabel(&#39;Count&#39;)
        #         plt.show()

        #         plot = df1.hvplot.barh( x=&#39;Shape&#39;, y=&#39;count&#39;, by=&#39;Manufacturer&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
        #         return plot.opts(title = &#34;img_shape for 2d and 3d dicoms&#34;)
        plotTitle = &#34;Image Shape distribution&#34;
        return df1, plotTitle

    def age(self, df, PreIndex=&#34;None&#34;):
        df1 = df.copy()

        if PreIndex == &#34;Cancer&#34;:
            df1 = self.index_pre(df1)

        elif PreIndex == &#34;NonCancer&#34;:
            df1 = self.nonCancer_pre(df1)

        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        # extracting numerical value from the string
        df1[&#34;PatientAge&#34;] = df1[&#34;PatientAge&#34;].str.extract(&#34;(\d+)&#34;, expand=False)

        # converting month into year
        df1[&#34;PatientAge&#34;] = df1[&#34;PatientAge&#34;].apply(lambda x: float(x) // 12)
        df1 = df1[~df1.PatientAge.isna()]

        # dividing pateint age into groups
        df1[&#34;PatientAgeGroup&#34;] = pd.cut(
            x=df1[&#34;PatientAge&#34;], bins=list(i for i in range(0, 100, 10)), right=False
        )

        df1 = df1.sort_values(by=&#34;PatientAgeGroup&#34;)
        df1[&#34;PatientAgeGroup&#34;] = df1[&#34;PatientAgeGroup&#34;].astype(str)
        #         df1 = df1.groupby([&#39;label&#39;, &#39;PatientAgeGroup&#39;]).size().reset_index(name = &#39;count&#39;)

        #         plot = df1.hvplot.bar( x=&#39;PatientAgeGroup&#39;, y=&#39;count&#39;, by=&#39;label&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
        plotTitle = &#34;Patient Age distribution&#34;
        #         return plot.opts(title = &#34;Patient Age distribution over Cancer and NonCancer labels&#34;)
        return df1, plotTitle

    def descriptivePlot(
        self,
        df,
        PreIndex=&#34;None&#34;,
        xLabel=&#34;Imagelaterality&#34;,
        category=&#34;label&#34;,
        plotLabel=&#34;image&#34;,
        plot=&#34;xaxis&#34;,
    ):
        df1 = df.copy()
        plotTitle = &#34;None&#34;

        if xLabel == &#34;Imagelaterality&#34; and category == &#34;label&#34;:
            df1, plotTitle = self.labelPlot(df1, PreIndex)
        if xLabel == &#34;PatientAgeGroup&#34;:
            df1, plotTitle = self.age(df1, PreIndex)
        if xLabel == &#34;Shape&#34;:
            df1, plotTitle = self.imgShape(df1, PreIndex)
        if (
            xLabel == &#34;Manufacturer&#34;
            or category == &#34;Manufacturer&#34;
            or plotLabel == &#34;Manufacturer&#34;
        ):
            df1, plotTitle = self.manufacturer(df1, PreIndex)

        df1 = (
            df1.groupby([str(xLabel), str(category), str(plotLabel)])
            .size()
            .reset_index(name=&#34;count&#34;)
        )
        df1 = df1.sort_values(by=category)

        if plotLabel == &#34;image&#34;:
            plotA = self.create(df1, xLabel, category, &#34;image&#34;, &#34;2D&#34;, plot).opts(
                cmap=&#34;Set2&#34;
            )
            plotB = self.create(df1, xLabel, category, &#34;image&#34;, &#34;3D&#34;, plot).opts(
                show_legend=False, cmap=&#34;Set2&#34;, yaxis=None
            )

            # add separate plots together again
            return df1, (plotA + plotB).opts(title=plotTitle)
        else:
            plotA = self.create(
                df1, xLabel, category, &#34;Manufacturer&#34;, &#34;HOLOGIC, INC.&#34;, &#34;yaxis&#34;
            ).opts(cmap=&#34;Set2&#34;)
            plotB = self.create(
                df1, xLabel, category, &#34;Manufacturer&#34;, &#34;GE MEDICAL SYSTEMS&#34;, &#34;yaxis&#34;
            ).opts(show_legend=False, cmap=&#34;Set2&#34;, yaxis=None)

            # add separate plots together again
            return df1, (plotA + plotB).opts(title=plotTitle)

    def testDataset(self, df):
        # pablo style start here
        #         df = df[df[&#39;label&#39;] != &#39;No Label information&#39;]
        #         df = df[df[&#39;Imagelaterality&#39;] != &#39;B&#39;]
        #         print(Counter(df[&#39;Manufacturer&#39;]))

        #         df,_ = self.manufacturer(df, PreIndex=&#39;Cancer&#39;)

        #         df = df[df[&#39;Manufacturer&#39;].isin([&#39;HOLOGIC, INC.&#39;, &#39;GE MEDICAL SYSTEMS&#39;])]
        #         print(Counter(df[&#39;Shape&#39;]))

        #         df,_ = self.imgShape(df, PreIndex=&#39;Cancer&#39;)
        #         counts = df[&#39;Shape&#39;].value_counts()
        #         df = df[~df[&#39;Shape&#39;].isin(counts[counts &lt; 500].index)]

        #         dfCancer = dfnonCancer = df
        # pablo style ends here

        df = df[df[&#34;label&#34;] != &#34;No Label information&#34;]
        df = df[df[&#34;Imagelaterality&#34;] != &#34;B&#34;]
        dfCancer = dfnonCancer = df
        dfCancer = dfCancer[dfCancer[&#34;label&#34;] != &#34;NonCancer&#34;]

        value1 = dfCancer[dfCancer[&#34;image&#34;] == &#34;3D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )
        value2 = dfCancer[dfCancer[&#34;image&#34;] == &#34;2D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )

        dfCancer = (
            pd.concat([value1, value2])
            .sort_values(&#34;image&#34;)
            .drop_duplicates(
                subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
            )
        )

        dfnonCancer = dfnonCancer[dfnonCancer[&#34;label&#34;] == &#34;NonCancer&#34;]

        value1 = dfnonCancer[dfnonCancer[&#34;image&#34;] == &#34;3D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )
        value2 = dfnonCancer[dfnonCancer[&#34;image&#34;] == &#34;2D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )

        dfnonCancer = (
            pd.concat([value1, value2])
            .sort_values(&#34;image&#34;)
            .drop_duplicates(
                subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
            )
        )

        test_df = (
            pd.concat([dfnonCancer, dfCancer])
            .sort_values(&#34;image&#34;)
            .drop_duplicates(
                subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
            )
        )

        test_df, _ = self.manufacturer(test_df, PreIndex=&#34;Cancer&#34;)

        test_df = test_df[
            test_df[&#34;Manufacturer&#34;].isin([&#34;HOLOGIC, INC.&#34;, &#34;GE MEDICAL SYSTEMS&#34;])
        ]

        test_df, _ = self.imgShape(test_df, PreIndex=&#34;Cancer&#34;)
        counts = test_df[&#34;Shape&#34;].value_counts()
        test_df = test_df[~test_df[&#34;Shape&#34;].isin(counts[counts &lt; 500].index)]

        return test_df


#     def pltDF(self, executionTime=False):

#         t0 = time.time()

#         can_plus_pre = self.index_pre()
#         notCan_plus_pre = self.nonCancer_pre()


#         plt.figure(figsize=(12, 6))
#         plt.subplot(2,2, 1)
#         sns.countplot(data=can_plus_pre, x=&#39;label&#39;, hue=&#39;image&#39;)
#         plt.title(&#34;Cancer(Index+Pre) vs Non Cancer dicoms for global&#34;)
#         plt.ylabel(&#39;No. of labels&#39;)
#         plt.subplot(2, 2, 2)
#         sns.countplot(data=notCan_plus_pre, x=&#39;label&#39;, hue=&#39;image&#39;)
#         plt.title(&#34;Cancer(Index) vs Non Cancer(+PreIndex) dicoms for global&#34;)
#         plt.ylabel(&#39;No. of labels&#39;)
#         plt.subplot(2, 2, 3)
#         sns.countplot(data=self.df[self.df[&#39;Imagelaterality&#39;] != &#39;None&#39;], x=&#39;Imagelaterality&#39;, hue=&#39;image&#39;)
#         plt.title(&#34;Left vs Right Breast dicom images for global&#34;)
#         plt.ylabel(&#39;No. of dicoms&#39;)
#         plt.subplot(2, 2, 4)
#         sns.countplot(data=self.df, x=&#39;image&#39;)
#         plt.title(&#34;2D vs 3D dicom images for global&#34;)
#         plt.ylabel(&#39;No. of dicoms&#39;)

#         plt.subplots_adjust(left=0.12,
#                     bottom=0.13,
#                     right=0.9,
#                     top=0.9,
#                     wspace=0.25,
#                     hspace=0.45)
#         plt.show()

#         if executionTime:
#             print(&#34;...took &#34;, time.time()-t0, &#34;seconds&#34;)
#             image2D= self.df[&#39;image&#39;] != &#39;3D&#39;
#             print(&#34;For 2D dicoms in global&#34;)
#             print(Counter(self.df[image2D][&#39;label&#39;]))
#             print(Counter(self.df[image2D][&#39;Imagelaterality&#39;]))
#             print(Counter(self.df[image2D][&#39;image&#39;]))
#             print(&#34;\n&#34;)

#             image3D= self.df[&#39;image&#39;] != &#39;2D&#39;
#             print(&#34;For 3D dicoms in global&#34;)
#             print(Counter(self.df[image3D][&#39;label&#39;]))
#             print(Counter(self.df[image3D][&#39;Imagelaterality&#39;]))
#             print(Counter(self.df[image3D][&#39;image&#39;]))

#         return self.df</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="omama.analysis.global_df_copy.Global_Plot"><code class="flex name class">
<span>class <span class="ident">Global_Plot</span></span>
<span>(</span><span>df, path=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Global_Plot:
    #     df = pd.DataFrame()

    def __init__(self, df, path=None):
        # sets the Data path variable
        self.path = str(path)

        t0 = time.time()

        #         pickles = [&#39;dh_dh2&#39;, &#39;dh_dh0new&#39;, &#39;dh_dcm_ast&#39;]

        #         for i in range(len(pickles)):
        #             #read the pickle file
        #             picklefile = open(self.path + pickles[i] + &#39;Label&#39;, &#39;rb&#39;)
        #             #unpickle the dataframe
        #             df_new = pickle.load(picklefile)
        #             self.df = pd.concat([self.df, df_new], ignore_index=True, sort=False)
        #             #close file
        #             picklefile.close()

        #         self.df = df
        print(&#34;Total dicoms available&#34;)
        print(Counter(df[&#34;image&#34;]))
        print(Counter(df[&#34;label&#34;]))
        print(Counter(df[&#34;Imagelaterality&#34;]))

    def index_pre(self, df):
        df1 = df.copy()
        df1[&#34;label&#34;] = df1[&#34;label&#34;].replace([&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], &#34;Cancer&#34;)
        df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
        df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

        #         df_plot = df1.groupby([&#39;label&#39;, &#39;image&#39;, &#39;Imagelaterality&#39;]).size().reset_index().pivot(columns=[&#39;label&#39;], index=[&#39;Imagelaterality&#39;, &#39;image&#39;], values=0)

        #         df_plot.plot(kind=&#39;bar&#39;, stacked=True, cmap = &#39;Paired&#39;)
        #         plt.title(&#34;Cancer(Index+PreIndex) vs Non Cancer dicoms for global&#34;)
        #         plt.ylabel(&#39;No. of labels&#39;)
        #         plt.show()

        return df1

    def nonCancer_pre(self, df):
        df1 = df.copy()

        df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
            [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], [&#34;Cancer&#34;, &#34;NonCancer&#34;]
        )
        df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
        df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

        #         df_plot = df1.groupby([&#39;label&#39;, &#39;image&#39;, &#39;Imagelaterality&#39;]).size().reset_index().pivot(columns=[&#39;label&#39;], index=[&#39;Imagelaterality&#39;, &#39;image&#39;], values=0)

        #         df_plot.plot(kind=&#39;bar&#39;, stacked=True, cmap = &#39;Paired&#39;)
        #         plt.title(&#34;Cancer(Index) vs Non Cancer(+PreIndex) dicoms for global&#34;)
        #         plt.ylabel(&#39;No. of labels&#39;)
        #         plt.show()

        return df1

    def create(self, df, xLabel, category, plotLabel, value, plot):
        if plot == &#34;xaxis&#34;:
            plot = df[df[str(plotLabel)] == value].hvplot.bar(
                x=str(xLabel),
                y=&#34;count&#34;,
                by=str(category),
                stacked=True,
                label=str(plotLabel) + &#34;: &#34; + value,
                legend=&#34;top_right&#34;,
                yformatter=&#34;%.0f&#34;,
                ylim=(0, 900000),
            )
        else:
            plot = df[df[str(plotLabel)] == value].hvplot.barh(
                x=str(xLabel),
                y=&#34;count&#34;,
                by=str(category),
                stacked=True,
                label=str(plotLabel) + &#34;: &#34; + value,
                legend=&#34;top_right&#34;,
                xformatter=&#34;%.0f&#34;,
            )

        return plot

    def labelPlot(self, df, PreIndex=&#34;None&#34;):
        df1 = df.copy()
        plotTitle = &#34;None&#34;
        if PreIndex == &#34;NonCancer&#34;:
            df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
                [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], [&#34;Cancer&#34;, &#34;NonCancer&#34;]
            )
            plotTitle = &#34;Cancer(Index) vs Non Cancer(+PreIndex) dicoms for global&#34;
        elif PreIndex == &#34;Cancer&#34;:
            df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
                [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], &#34;Cancer&#34;
            )
            plotTitle = &#34;Cancer(Index+PreIndex) vs Non Cancer dicoms for global&#34;
        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
        df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

        #         df1 = df1.groupby([&#39;label&#39;, &#39;image&#39;,&#39;Imagelaterality&#39;]).size().reset_index(name = &#39;count&#39;)

        #         plotA = self.create(df1, &#39;2D&#39;)
        #         plotB = self.create(df1, &#39;3D&#39;).opts(show_legend=False, yaxis=None)

        #         # add separate plots together again
        #         return (plotA + plotB).opts(title = plotTitle)
        return df1, plotTitle

    def manufacturer(self, df, PreIndex=&#34;None&#34;):
        df1 = df.copy()

        if PreIndex == &#34;Cancer&#34;:
            df1 = self.index_pre(df1)

        elif PreIndex == &#34;NonCancer&#34;:
            df1 = self.nonCancer_pre(df1)

        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        # replacing case sensitive and same manufarcturer name values with one value
        df1[&#34;Manufacturer&#34;] = df1[&#34;Manufacturer&#34;].replace(
            [
                &#34;HOLOGIC, Inc.&#34;,
                &#34;Hologic, Inc.&#34;,
                &#34;HOLOGIC, INC.&#34;,
                &#34;LORAD&#34;,
                &#34;Lorad&#34;,
                &#34;LORAD.&#34;,
                &#34;Lorad, A Hologic Company&#34;,
            ],
            &#34;HOLOGIC, INC.&#34;,
        )
        df1[&#34;Manufacturer&#34;] = df1[&#34;Manufacturer&#34;].replace(
            [&#34;FUJI PHOTO FILM Co., ltd.&#34;, &#34;FUJIFILM Corporation&#34;],
            &#34;FUJIFILM Corporation&#34;,
        )

        #         #multi indexing
        #         df1 = df1.groupby([&#39;Manufacturer&#39;, &#39;image&#39;]).size().reset_index(name = &#39;count&#39;)
        #         plot = df1.hvplot.barh( x=&#39;Manufacturer&#39;, y=&#39;count&#39;, by=&#39;image&#39;, cmap =&#39;Paired&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
        # #         df1.plot(kind=&#39;barh&#39;, stacked=True, cmap = &#39;Paired_r&#39;)
        # #         plt.title(&#34;Manufaractures and modality informations for 2d and 3d dicoms&#34;)
        # #         plt.xlabel(&#39;Count&#39;)
        #         return plot.opts(title = &#34;Manufaractures informations for 2d and 3d dicoms&#34;)
        plotTitle = &#34;Manufacturer distribution&#34;
        return df1, plotTitle

    def imgShape(self, df, PreIndex=&#34;None&#34;):
        # since no of frames can be different so replacing all the similaer pattern 3D shape whith &#39;x&#39;
        df1 = df.copy()

        if PreIndex == &#34;Cancer&#34;:
            df1 = self.index_pre(df1)

        elif PreIndex == &#34;NonCancer&#34;:
            df1 = self.nonCancer_pre(df1)

        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].astype(str)
        df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].str.replace(&#34;(2457, 1890,.*)&#34;, &#34;2457, 1890, x)&#34;)
        df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].str.replace(&#34;(2457, 1996,.*)&#34;, &#34;2457, 1996, x)&#34;)

        # remove shape less than (1024, 1024)
        pattern = &#34;(2059, 652,.*)|(2023, 918,.*)|(512, 512)|(707, 989)|(794, 990)&#34;
        df1 = df1[~df1[&#34;Shape&#34;].str.contains(pattern)]
        # with 2.2% images filtered out

        #         df1 = df1.groupby([&#39;Manufacturer&#39;, &#39;Shape&#39;]).size().reset_index(name = &#39;count&#39;)
        # not select if count &lt; 50
        counts = df1[&#34;Shape&#34;].value_counts()
        df1 = df1[~df1[&#34;Shape&#34;].isin(counts[counts &lt; 50].index)]

        df1 = df1.sort_values(by=&#34;Shape&#34;)
        #         # multi indexing
        #         df1 = df1.pivot(columns=[&#39;image&#39;], index=[&#39;Shape&#39;], values=&#39;count&#39;)

        #         df1.plot(kind=&#39;barh&#39;, stacked=True, cmap = &#39;Paired_r&#39;)
        #         plt.title(&#34;img_shape for 2d and 3d dicoms&#34;)
        #         plt.xlabel(&#39;Count&#39;)
        #         plt.show()

        #         plot = df1.hvplot.barh( x=&#39;Shape&#39;, y=&#39;count&#39;, by=&#39;Manufacturer&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
        #         return plot.opts(title = &#34;img_shape for 2d and 3d dicoms&#34;)
        plotTitle = &#34;Image Shape distribution&#34;
        return df1, plotTitle

    def age(self, df, PreIndex=&#34;None&#34;):
        df1 = df.copy()

        if PreIndex == &#34;Cancer&#34;:
            df1 = self.index_pre(df1)

        elif PreIndex == &#34;NonCancer&#34;:
            df1 = self.nonCancer_pre(df1)

        else:
            print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

        # extracting numerical value from the string
        df1[&#34;PatientAge&#34;] = df1[&#34;PatientAge&#34;].str.extract(&#34;(\d+)&#34;, expand=False)

        # converting month into year
        df1[&#34;PatientAge&#34;] = df1[&#34;PatientAge&#34;].apply(lambda x: float(x) // 12)
        df1 = df1[~df1.PatientAge.isna()]

        # dividing pateint age into groups
        df1[&#34;PatientAgeGroup&#34;] = pd.cut(
            x=df1[&#34;PatientAge&#34;], bins=list(i for i in range(0, 100, 10)), right=False
        )

        df1 = df1.sort_values(by=&#34;PatientAgeGroup&#34;)
        df1[&#34;PatientAgeGroup&#34;] = df1[&#34;PatientAgeGroup&#34;].astype(str)
        #         df1 = df1.groupby([&#39;label&#39;, &#39;PatientAgeGroup&#39;]).size().reset_index(name = &#39;count&#39;)

        #         plot = df1.hvplot.bar( x=&#39;PatientAgeGroup&#39;, y=&#39;count&#39;, by=&#39;label&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
        plotTitle = &#34;Patient Age distribution&#34;
        #         return plot.opts(title = &#34;Patient Age distribution over Cancer and NonCancer labels&#34;)
        return df1, plotTitle

    def descriptivePlot(
        self,
        df,
        PreIndex=&#34;None&#34;,
        xLabel=&#34;Imagelaterality&#34;,
        category=&#34;label&#34;,
        plotLabel=&#34;image&#34;,
        plot=&#34;xaxis&#34;,
    ):
        df1 = df.copy()
        plotTitle = &#34;None&#34;

        if xLabel == &#34;Imagelaterality&#34; and category == &#34;label&#34;:
            df1, plotTitle = self.labelPlot(df1, PreIndex)
        if xLabel == &#34;PatientAgeGroup&#34;:
            df1, plotTitle = self.age(df1, PreIndex)
        if xLabel == &#34;Shape&#34;:
            df1, plotTitle = self.imgShape(df1, PreIndex)
        if (
            xLabel == &#34;Manufacturer&#34;
            or category == &#34;Manufacturer&#34;
            or plotLabel == &#34;Manufacturer&#34;
        ):
            df1, plotTitle = self.manufacturer(df1, PreIndex)

        df1 = (
            df1.groupby([str(xLabel), str(category), str(plotLabel)])
            .size()
            .reset_index(name=&#34;count&#34;)
        )
        df1 = df1.sort_values(by=category)

        if plotLabel == &#34;image&#34;:
            plotA = self.create(df1, xLabel, category, &#34;image&#34;, &#34;2D&#34;, plot).opts(
                cmap=&#34;Set2&#34;
            )
            plotB = self.create(df1, xLabel, category, &#34;image&#34;, &#34;3D&#34;, plot).opts(
                show_legend=False, cmap=&#34;Set2&#34;, yaxis=None
            )

            # add separate plots together again
            return df1, (plotA + plotB).opts(title=plotTitle)
        else:
            plotA = self.create(
                df1, xLabel, category, &#34;Manufacturer&#34;, &#34;HOLOGIC, INC.&#34;, &#34;yaxis&#34;
            ).opts(cmap=&#34;Set2&#34;)
            plotB = self.create(
                df1, xLabel, category, &#34;Manufacturer&#34;, &#34;GE MEDICAL SYSTEMS&#34;, &#34;yaxis&#34;
            ).opts(show_legend=False, cmap=&#34;Set2&#34;, yaxis=None)

            # add separate plots together again
            return df1, (plotA + plotB).opts(title=plotTitle)

    def testDataset(self, df):
        # pablo style start here
        #         df = df[df[&#39;label&#39;] != &#39;No Label information&#39;]
        #         df = df[df[&#39;Imagelaterality&#39;] != &#39;B&#39;]
        #         print(Counter(df[&#39;Manufacturer&#39;]))

        #         df,_ = self.manufacturer(df, PreIndex=&#39;Cancer&#39;)

        #         df = df[df[&#39;Manufacturer&#39;].isin([&#39;HOLOGIC, INC.&#39;, &#39;GE MEDICAL SYSTEMS&#39;])]
        #         print(Counter(df[&#39;Shape&#39;]))

        #         df,_ = self.imgShape(df, PreIndex=&#39;Cancer&#39;)
        #         counts = df[&#39;Shape&#39;].value_counts()
        #         df = df[~df[&#39;Shape&#39;].isin(counts[counts &lt; 500].index)]

        #         dfCancer = dfnonCancer = df
        # pablo style ends here

        df = df[df[&#34;label&#34;] != &#34;No Label information&#34;]
        df = df[df[&#34;Imagelaterality&#34;] != &#34;B&#34;]
        dfCancer = dfnonCancer = df
        dfCancer = dfCancer[dfCancer[&#34;label&#34;] != &#34;NonCancer&#34;]

        value1 = dfCancer[dfCancer[&#34;image&#34;] == &#34;3D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )
        value2 = dfCancer[dfCancer[&#34;image&#34;] == &#34;2D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )

        dfCancer = (
            pd.concat([value1, value2])
            .sort_values(&#34;image&#34;)
            .drop_duplicates(
                subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
            )
        )

        dfnonCancer = dfnonCancer[dfnonCancer[&#34;label&#34;] == &#34;NonCancer&#34;]

        value1 = dfnonCancer[dfnonCancer[&#34;image&#34;] == &#34;3D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )
        value2 = dfnonCancer[dfnonCancer[&#34;image&#34;] == &#34;2D&#34;].drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;]
        )

        dfnonCancer = (
            pd.concat([value1, value2])
            .sort_values(&#34;image&#34;)
            .drop_duplicates(
                subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
            )
        )

        test_df = (
            pd.concat([dfnonCancer, dfCancer])
            .sort_values(&#34;image&#34;)
            .drop_duplicates(
                subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
            )
        )

        test_df, _ = self.manufacturer(test_df, PreIndex=&#34;Cancer&#34;)

        test_df = test_df[
            test_df[&#34;Manufacturer&#34;].isin([&#34;HOLOGIC, INC.&#34;, &#34;GE MEDICAL SYSTEMS&#34;])
        ]

        test_df, _ = self.imgShape(test_df, PreIndex=&#34;Cancer&#34;)
        counts = test_df[&#34;Shape&#34;].value_counts()
        test_df = test_df[~test_df[&#34;Shape&#34;].isin(counts[counts &lt; 500].index)]

        return test_df</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="omama.analysis.global_df_copy.Global_Plot.age"><code class="name flex">
<span>def <span class="ident">age</span></span>(<span>self, df, PreIndex='None')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def age(self, df, PreIndex=&#34;None&#34;):
    df1 = df.copy()

    if PreIndex == &#34;Cancer&#34;:
        df1 = self.index_pre(df1)

    elif PreIndex == &#34;NonCancer&#34;:
        df1 = self.nonCancer_pre(df1)

    else:
        print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

    # extracting numerical value from the string
    df1[&#34;PatientAge&#34;] = df1[&#34;PatientAge&#34;].str.extract(&#34;(\d+)&#34;, expand=False)

    # converting month into year
    df1[&#34;PatientAge&#34;] = df1[&#34;PatientAge&#34;].apply(lambda x: float(x) // 12)
    df1 = df1[~df1.PatientAge.isna()]

    # dividing pateint age into groups
    df1[&#34;PatientAgeGroup&#34;] = pd.cut(
        x=df1[&#34;PatientAge&#34;], bins=list(i for i in range(0, 100, 10)), right=False
    )

    df1 = df1.sort_values(by=&#34;PatientAgeGroup&#34;)
    df1[&#34;PatientAgeGroup&#34;] = df1[&#34;PatientAgeGroup&#34;].astype(str)
    #         df1 = df1.groupby([&#39;label&#39;, &#39;PatientAgeGroup&#39;]).size().reset_index(name = &#39;count&#39;)

    #         plot = df1.hvplot.bar( x=&#39;PatientAgeGroup&#39;, y=&#39;count&#39;, by=&#39;label&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
    plotTitle = &#34;Patient Age distribution&#34;
    #         return plot.opts(title = &#34;Patient Age distribution over Cancer and NonCancer labels&#34;)
    return df1, plotTitle</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.create"><code class="name flex">
<span>def <span class="ident">create</span></span>(<span>self, df, xLabel, category, plotLabel, value, plot)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create(self, df, xLabel, category, plotLabel, value, plot):
    if plot == &#34;xaxis&#34;:
        plot = df[df[str(plotLabel)] == value].hvplot.bar(
            x=str(xLabel),
            y=&#34;count&#34;,
            by=str(category),
            stacked=True,
            label=str(plotLabel) + &#34;: &#34; + value,
            legend=&#34;top_right&#34;,
            yformatter=&#34;%.0f&#34;,
            ylim=(0, 900000),
        )
    else:
        plot = df[df[str(plotLabel)] == value].hvplot.barh(
            x=str(xLabel),
            y=&#34;count&#34;,
            by=str(category),
            stacked=True,
            label=str(plotLabel) + &#34;: &#34; + value,
            legend=&#34;top_right&#34;,
            xformatter=&#34;%.0f&#34;,
        )

    return plot</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.descriptivePlot"><code class="name flex">
<span>def <span class="ident">descriptivePlot</span></span>(<span>self, df, PreIndex='None', xLabel='Imagelaterality', category='label', plotLabel='image', plot='xaxis')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def descriptivePlot(
    self,
    df,
    PreIndex=&#34;None&#34;,
    xLabel=&#34;Imagelaterality&#34;,
    category=&#34;label&#34;,
    plotLabel=&#34;image&#34;,
    plot=&#34;xaxis&#34;,
):
    df1 = df.copy()
    plotTitle = &#34;None&#34;

    if xLabel == &#34;Imagelaterality&#34; and category == &#34;label&#34;:
        df1, plotTitle = self.labelPlot(df1, PreIndex)
    if xLabel == &#34;PatientAgeGroup&#34;:
        df1, plotTitle = self.age(df1, PreIndex)
    if xLabel == &#34;Shape&#34;:
        df1, plotTitle = self.imgShape(df1, PreIndex)
    if (
        xLabel == &#34;Manufacturer&#34;
        or category == &#34;Manufacturer&#34;
        or plotLabel == &#34;Manufacturer&#34;
    ):
        df1, plotTitle = self.manufacturer(df1, PreIndex)

    df1 = (
        df1.groupby([str(xLabel), str(category), str(plotLabel)])
        .size()
        .reset_index(name=&#34;count&#34;)
    )
    df1 = df1.sort_values(by=category)

    if plotLabel == &#34;image&#34;:
        plotA = self.create(df1, xLabel, category, &#34;image&#34;, &#34;2D&#34;, plot).opts(
            cmap=&#34;Set2&#34;
        )
        plotB = self.create(df1, xLabel, category, &#34;image&#34;, &#34;3D&#34;, plot).opts(
            show_legend=False, cmap=&#34;Set2&#34;, yaxis=None
        )

        # add separate plots together again
        return df1, (plotA + plotB).opts(title=plotTitle)
    else:
        plotA = self.create(
            df1, xLabel, category, &#34;Manufacturer&#34;, &#34;HOLOGIC, INC.&#34;, &#34;yaxis&#34;
        ).opts(cmap=&#34;Set2&#34;)
        plotB = self.create(
            df1, xLabel, category, &#34;Manufacturer&#34;, &#34;GE MEDICAL SYSTEMS&#34;, &#34;yaxis&#34;
        ).opts(show_legend=False, cmap=&#34;Set2&#34;, yaxis=None)

        # add separate plots together again
        return df1, (plotA + plotB).opts(title=plotTitle)</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.imgShape"><code class="name flex">
<span>def <span class="ident">imgShape</span></span>(<span>self, df, PreIndex='None')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def imgShape(self, df, PreIndex=&#34;None&#34;):
    # since no of frames can be different so replacing all the similaer pattern 3D shape whith &#39;x&#39;
    df1 = df.copy()

    if PreIndex == &#34;Cancer&#34;:
        df1 = self.index_pre(df1)

    elif PreIndex == &#34;NonCancer&#34;:
        df1 = self.nonCancer_pre(df1)

    else:
        print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

    df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].astype(str)
    df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].str.replace(&#34;(2457, 1890,.*)&#34;, &#34;2457, 1890, x)&#34;)
    df1[&#34;Shape&#34;] = df1[&#34;Shape&#34;].str.replace(&#34;(2457, 1996,.*)&#34;, &#34;2457, 1996, x)&#34;)

    # remove shape less than (1024, 1024)
    pattern = &#34;(2059, 652,.*)|(2023, 918,.*)|(512, 512)|(707, 989)|(794, 990)&#34;
    df1 = df1[~df1[&#34;Shape&#34;].str.contains(pattern)]
    # with 2.2% images filtered out

    #         df1 = df1.groupby([&#39;Manufacturer&#39;, &#39;Shape&#39;]).size().reset_index(name = &#39;count&#39;)
    # not select if count &lt; 50
    counts = df1[&#34;Shape&#34;].value_counts()
    df1 = df1[~df1[&#34;Shape&#34;].isin(counts[counts &lt; 50].index)]

    df1 = df1.sort_values(by=&#34;Shape&#34;)
    #         # multi indexing
    #         df1 = df1.pivot(columns=[&#39;image&#39;], index=[&#39;Shape&#39;], values=&#39;count&#39;)

    #         df1.plot(kind=&#39;barh&#39;, stacked=True, cmap = &#39;Paired_r&#39;)
    #         plt.title(&#34;img_shape for 2d and 3d dicoms&#34;)
    #         plt.xlabel(&#39;Count&#39;)
    #         plt.show()

    #         plot = df1.hvplot.barh( x=&#39;Shape&#39;, y=&#39;count&#39;, by=&#39;Manufacturer&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
    #         return plot.opts(title = &#34;img_shape for 2d and 3d dicoms&#34;)
    plotTitle = &#34;Image Shape distribution&#34;
    return df1, plotTitle</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.index_pre"><code class="name flex">
<span>def <span class="ident">index_pre</span></span>(<span>self, df)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def index_pre(self, df):
    df1 = df.copy()
    df1[&#34;label&#34;] = df1[&#34;label&#34;].replace([&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], &#34;Cancer&#34;)
    df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
    df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

    #         df_plot = df1.groupby([&#39;label&#39;, &#39;image&#39;, &#39;Imagelaterality&#39;]).size().reset_index().pivot(columns=[&#39;label&#39;], index=[&#39;Imagelaterality&#39;, &#39;image&#39;], values=0)

    #         df_plot.plot(kind=&#39;bar&#39;, stacked=True, cmap = &#39;Paired&#39;)
    #         plt.title(&#34;Cancer(Index+PreIndex) vs Non Cancer dicoms for global&#34;)
    #         plt.ylabel(&#39;No. of labels&#39;)
    #         plt.show()

    return df1</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.labelPlot"><code class="name flex">
<span>def <span class="ident">labelPlot</span></span>(<span>self, df, PreIndex='None')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def labelPlot(self, df, PreIndex=&#34;None&#34;):
    df1 = df.copy()
    plotTitle = &#34;None&#34;
    if PreIndex == &#34;NonCancer&#34;:
        df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
            [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], [&#34;Cancer&#34;, &#34;NonCancer&#34;]
        )
        plotTitle = &#34;Cancer(Index) vs Non Cancer(+PreIndex) dicoms for global&#34;
    elif PreIndex == &#34;Cancer&#34;:
        df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
            [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], &#34;Cancer&#34;
        )
        plotTitle = &#34;Cancer(Index+PreIndex) vs Non Cancer dicoms for global&#34;
    else:
        print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

    df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
    df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

    #         df1 = df1.groupby([&#39;label&#39;, &#39;image&#39;,&#39;Imagelaterality&#39;]).size().reset_index(name = &#39;count&#39;)

    #         plotA = self.create(df1, &#39;2D&#39;)
    #         plotB = self.create(df1, &#39;3D&#39;).opts(show_legend=False, yaxis=None)

    #         # add separate plots together again
    #         return (plotA + plotB).opts(title = plotTitle)
    return df1, plotTitle</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.manufacturer"><code class="name flex">
<span>def <span class="ident">manufacturer</span></span>(<span>self, df, PreIndex='None')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def manufacturer(self, df, PreIndex=&#34;None&#34;):
    df1 = df.copy()

    if PreIndex == &#34;Cancer&#34;:
        df1 = self.index_pre(df1)

    elif PreIndex == &#34;NonCancer&#34;:
        df1 = self.nonCancer_pre(df1)

    else:
        print(&#34;Error, please provide what you wanna see PreIndex as....&#34;)

    # replacing case sensitive and same manufarcturer name values with one value
    df1[&#34;Manufacturer&#34;] = df1[&#34;Manufacturer&#34;].replace(
        [
            &#34;HOLOGIC, Inc.&#34;,
            &#34;Hologic, Inc.&#34;,
            &#34;HOLOGIC, INC.&#34;,
            &#34;LORAD&#34;,
            &#34;Lorad&#34;,
            &#34;LORAD.&#34;,
            &#34;Lorad, A Hologic Company&#34;,
        ],
        &#34;HOLOGIC, INC.&#34;,
    )
    df1[&#34;Manufacturer&#34;] = df1[&#34;Manufacturer&#34;].replace(
        [&#34;FUJI PHOTO FILM Co., ltd.&#34;, &#34;FUJIFILM Corporation&#34;],
        &#34;FUJIFILM Corporation&#34;,
    )

    #         #multi indexing
    #         df1 = df1.groupby([&#39;Manufacturer&#39;, &#39;image&#39;]).size().reset_index(name = &#39;count&#39;)
    #         plot = df1.hvplot.barh( x=&#39;Manufacturer&#39;, y=&#39;count&#39;, by=&#39;image&#39;, cmap =&#39;Paired&#39;, stacked=True, legend=&#39;top_right&#39;, height = 500, width = 800,)
    # #         df1.plot(kind=&#39;barh&#39;, stacked=True, cmap = &#39;Paired_r&#39;)
    # #         plt.title(&#34;Manufaractures and modality informations for 2d and 3d dicoms&#34;)
    # #         plt.xlabel(&#39;Count&#39;)
    #         return plot.opts(title = &#34;Manufaractures informations for 2d and 3d dicoms&#34;)
    plotTitle = &#34;Manufacturer distribution&#34;
    return df1, plotTitle</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.nonCancer_pre"><code class="name flex">
<span>def <span class="ident">nonCancer_pre</span></span>(<span>self, df)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def nonCancer_pre(self, df):
    df1 = df.copy()

    df1[&#34;label&#34;] = df1[&#34;label&#34;].replace(
        [&#34;IndexCancer&#34;, &#34;PreIndexCancer&#34;], [&#34;Cancer&#34;, &#34;NonCancer&#34;]
    )
    df1 = df1[df1[&#34;label&#34;] != &#34;No Label information&#34;]
    df1 = df1[df1[&#34;Imagelaterality&#34;] != &#34;B&#34;]

    #         df_plot = df1.groupby([&#39;label&#39;, &#39;image&#39;, &#39;Imagelaterality&#39;]).size().reset_index().pivot(columns=[&#39;label&#39;], index=[&#39;Imagelaterality&#39;, &#39;image&#39;], values=0)

    #         df_plot.plot(kind=&#39;bar&#39;, stacked=True, cmap = &#39;Paired&#39;)
    #         plt.title(&#34;Cancer(Index) vs Non Cancer(+PreIndex) dicoms for global&#34;)
    #         plt.ylabel(&#39;No. of labels&#39;)
    #         plt.show()

    return df1</code></pre>
</details>
</dd>
<dt id="omama.analysis.global_df_copy.Global_Plot.testDataset"><code class="name flex">
<span>def <span class="ident">testDataset</span></span>(<span>self, df)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def testDataset(self, df):
    # pablo style start here
    #         df = df[df[&#39;label&#39;] != &#39;No Label information&#39;]
    #         df = df[df[&#39;Imagelaterality&#39;] != &#39;B&#39;]
    #         print(Counter(df[&#39;Manufacturer&#39;]))

    #         df,_ = self.manufacturer(df, PreIndex=&#39;Cancer&#39;)

    #         df = df[df[&#39;Manufacturer&#39;].isin([&#39;HOLOGIC, INC.&#39;, &#39;GE MEDICAL SYSTEMS&#39;])]
    #         print(Counter(df[&#39;Shape&#39;]))

    #         df,_ = self.imgShape(df, PreIndex=&#39;Cancer&#39;)
    #         counts = df[&#39;Shape&#39;].value_counts()
    #         df = df[~df[&#39;Shape&#39;].isin(counts[counts &lt; 500].index)]

    #         dfCancer = dfnonCancer = df
    # pablo style ends here

    df = df[df[&#34;label&#34;] != &#34;No Label information&#34;]
    df = df[df[&#34;Imagelaterality&#34;] != &#34;B&#34;]
    dfCancer = dfnonCancer = df
    dfCancer = dfCancer[dfCancer[&#34;label&#34;] != &#34;NonCancer&#34;]

    value1 = dfCancer[dfCancer[&#34;image&#34;] == &#34;3D&#34;].drop_duplicates(
        subset=[&#34;StudyInstanceUID&#34;]
    )
    value2 = dfCancer[dfCancer[&#34;image&#34;] == &#34;2D&#34;].drop_duplicates(
        subset=[&#34;StudyInstanceUID&#34;]
    )

    dfCancer = (
        pd.concat([value1, value2])
        .sort_values(&#34;image&#34;)
        .drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
        )
    )

    dfnonCancer = dfnonCancer[dfnonCancer[&#34;label&#34;] == &#34;NonCancer&#34;]

    value1 = dfnonCancer[dfnonCancer[&#34;image&#34;] == &#34;3D&#34;].drop_duplicates(
        subset=[&#34;StudyInstanceUID&#34;]
    )
    value2 = dfnonCancer[dfnonCancer[&#34;image&#34;] == &#34;2D&#34;].drop_duplicates(
        subset=[&#34;StudyInstanceUID&#34;]
    )

    dfnonCancer = (
        pd.concat([value1, value2])
        .sort_values(&#34;image&#34;)
        .drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
        )
    )

    test_df = (
        pd.concat([dfnonCancer, dfCancer])
        .sort_values(&#34;image&#34;)
        .drop_duplicates(
            subset=[&#34;StudyInstanceUID&#34;, &#34;StudyInstanceUID&#34;], keep=&#34;last&#34;
        )
    )

    test_df, _ = self.manufacturer(test_df, PreIndex=&#34;Cancer&#34;)

    test_df = test_df[
        test_df[&#34;Manufacturer&#34;].isin([&#34;HOLOGIC, INC.&#34;, &#34;GE MEDICAL SYSTEMS&#34;])
    ]

    test_df, _ = self.imgShape(test_df, PreIndex=&#34;Cancer&#34;)
    counts = test_df[&#34;Shape&#34;].value_counts()
    test_df = test_df[~test_df[&#34;Shape&#34;].isin(counts[counts &lt; 500].index)]

    return test_df</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="omama.analysis" href="index.html">omama.analysis</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="omama.analysis.global_df_copy.Global_Plot" href="#omama.analysis.global_df_copy.Global_Plot">Global_Plot</a></code></h4>
<ul class="two-column">
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.age" href="#omama.analysis.global_df_copy.Global_Plot.age">age</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.create" href="#omama.analysis.global_df_copy.Global_Plot.create">create</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.descriptivePlot" href="#omama.analysis.global_df_copy.Global_Plot.descriptivePlot">descriptivePlot</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.imgShape" href="#omama.analysis.global_df_copy.Global_Plot.imgShape">imgShape</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.index_pre" href="#omama.analysis.global_df_copy.Global_Plot.index_pre">index_pre</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.labelPlot" href="#omama.analysis.global_df_copy.Global_Plot.labelPlot">labelPlot</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.manufacturer" href="#omama.analysis.global_df_copy.Global_Plot.manufacturer">manufacturer</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.nonCancer_pre" href="#omama.analysis.global_df_copy.Global_Plot.nonCancer_pre">nonCancer_pre</a></code></li>
<li><code><a title="omama.analysis.global_df_copy.Global_Plot.testDataset" href="#omama.analysis.global_df_copy.Global_Plot.testDataset">testDataset</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>